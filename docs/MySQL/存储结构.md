# 存储结构

存储的行为是由存储引擎实现的，不同的存储引擎实现不同，这里只讲 InnoDB。


默认情况下， MySQL 的数据库文件存放在 `/var/lib/mysql` 目录下，每个数据库对应一个目录，目录名称就是数据库名称。

目录下存放着数据库的表文件，表文件的后缀名是 `.frm`，存放表的结构信息。表的数据存放在 `.ibd` 文件中。

??? example
    ```shell
    $ tree /var/lib/mysql/user_center
    user_center
        ├── db.opt
        ├── userinfo.frm
        └── userinfo.ibd
    ```

    以上是 `user_center` 数据库下的 `userinfo` 表：

    - `db.opt` 存放数据库的一些配置信息，例如数据库的默认字符集和字符校验规则等等。
    - `userinfo.frm` 存放表的结构信息，MySQL 中每建立一张表都会生成一个 `.frm` 文件，主要包含表结构定义等信息。
    - `userinfo.ibd` 存放表的数。表数据既可以存放在共享表空间（文件名: ibdata1）中，也可以存放在独立的表空间中（文件名: 表名.ibd），
        这个由 `innodb_file_per_table` 参数决定，1 则使用独占表空间，0 则使用共享表空间。从 MySQL 5.6.6 开始，`innodb_file_per_table` 默认为 1。

    除了这些文件，还有一些其他文件，例如 `ibdata1`、`ib_logfile0`、`ib_logfile1`、`ib_logfile2` 等等，这些文件是 InnoDB 存储引擎的文件，用来存放 InnoDB 存储引擎的数据和日志信息。

## 表空间文件结构
一共有这些单位：**<font color='blue'>表空间（tablespace）、段（Segment）、区（Extent）、页（Page）、行（Row）</font>**。

表空间（tablespace）由段（Segment）构成，段由区（Extent）构成，区由页（Page）构成，页由行（Row）构成，页是存储的最小单位。

![表结构](https://blogpicure.oss-cn-shenzhen.aliyuncs.com/blog/illustration-pic/distributed/mysql_table_struct2.png)

![表结构](https://blogpicure.oss-cn-shenzhen.aliyuncs.com/blog/illustration-pic/distributed/mysql_table_struct.png)


### 行 row
数据库表中的记录都是按行存放的，每行记录根据不同的行格式有不同的存储结构。

### 页 page
记录是按照行存储的，但是数据库不会以「行」为单位，否则一次读取（一次 I/O）只能处理一行的数据，效率很低。

所以 InnoDB 的数据是按照「页」为单位来读取的，即当我们要读一条记录的时候，这一页的数据都将被读到内存中，<font color='green'>默认每个页的大小为 16KB</font>。

页是 InnoDB 磁盘管理的最小单元，所以每次读写都是以 16KB 为单位，一次最少读 16KB 的内容到内存，一次最少把内存中的 16KB 内容刷新到磁盘。

页的类型有很多，常见的有数据页、undo 日志页、溢出页等。表中的行记录是存储在「数据页」的。

### 区 extent
